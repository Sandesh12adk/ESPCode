#include <Wire.h>
#include <Adafruit_BMP085.h>
#include <DHT.h>

/* -------- PIN DEFINITIONS -------- */
#define BMP_SDA 25
#define BMP_SCL 26
#define DHTPIN  14

/* -------- SENSOR TYPE -------- */
#define DHTTYPE DHT11   // Change to DHT22 if your sensor is DHT22

/* -------- OBJECTS -------- */
Adafruit_BMP085 bmp;
DHT dht(DHTPIN, DHTTYPE);

void setup() {
  Serial.begin(115200);
  delay(2000); // Wait for Serial Monitor
  Serial.println("\n=== ESP32 SENSOR DEBUG START ===");

  /* ---- I2C INIT ---- */
  Wire.begin(BMP_SDA, BMP_SCL);
  Serial.println("I2C initialized on SDA=" + String(BMP_SDA) + ", SCL=" + String(BMP_SCL));

  /* ---- I2C SCAN ---- */
  Serial.println("Scanning I2C bus...");
  bool deviceFound = false;
  for (byte address = 1; address < 127; address++) {
    Wire.beginTransmission(address);
    if (Wire.endTransmission() == 0) {
      Serial.print("I2C device found at 0x");
      Serial.println(address, HEX);
      deviceFound = true;
    }
  }
  if (!deviceFound) {
    Serial.println("❌ No I2C devices found. Check wiring and power.");
  } else {
    Serial.println("✅ I2C scan complete.");
  }

  /* ---- BMP180 INIT ---- */
  Serial.println("Initializing BMP180...");
  if (!bmp.begin()) {
    Serial.println("❌ BMP180 not found. Check wiring!");
  } else {
    Serial.println("✅ BMP180 initialized successfully.");
  }

  /* ---- DHT INIT ---- */
  dht.begin();
  Serial.println("✅ DHT sensor initialized");

  Serial.println("=== SETUP COMPLETE ===");
}

void loop() {
  Serial.println("\n---- SENSOR READINGS ----");

  /* ---- BMP180 READ ---- */
  if (!bmp.begin()) {
    Serial.println("❌ BMP180 read skipped because sensor not initialized.");
  } else {
    float bmpTemp = bmp.readTemperature();
    float bmpPressure = bmp.readPressure(); // Pa

    if (isnan(bmpTemp) || isnan(bmpPressure)) {
      Serial.println("❌ BMP180 read failed");
    } else {
      Serial.print("BMP Temperature: ");
      Serial.print(bmpTemp);
      Serial.println(" °C");

      Serial.print("Pressure: ");
      Serial.print(bmpPressure);
      Serial.println(" Pa");
    }
  }

  /* ---- DHT READ ---- */
  float humidity = dht.readHumidity();
  float dhtTemp = dht.readTemperature();

  if (!isnan(humidity)) {
    Serial.print("DHT Humidity: ");
    Serial.print(humidity);
    Serial.println(" %");
  } else {
    Serial.println("❌ DHT humidity read failed");
  }

  if (!isnan(dhtTemp)) {
    Serial.print("DHT Temperature: ");
    Serial.print(dhtTemp);
    Serial.println(" °C");
  } else {
    Serial.println("❌ DHT temperature read failed");
  }

  Serial.println("-------------------------");
  delay(2000);
}